

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pewtils.__init__ &mdash; pewtils 1.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> pewtils
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pewtils_core.html">Core Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../http.html">HTTP Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../io.html">I/O Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../regex.html">Regex Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pewtils</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>pewtils.__init__</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pewtils.__init__</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">chardet</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">zipcodes</span>
<span class="kn">import</span> <span class="nn">signal</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">importlib.machinery</span> <span class="k">import</span> <span class="n">SourceFileLoader</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">imp</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">random</span> <span class="k">import</span> <span class="n">uniform</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="k">import</span> <span class="n">closing</span>
<span class="kn">from</span> <span class="nn">scandir</span> <span class="k">import</span> <span class="n">walk</span>
<span class="kn">from</span> <span class="nn">unidecode</span> <span class="k">import</span> <span class="n">unidecode</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="k">import</span> <span class="n">md5</span>


<div class="viewcode-block" id="classproperty"><a class="viewcode-back" href="../../pewtils_core.html#pewtils.__init__.classproperty">[docs]</a><span class="k">class</span> <span class="nc">classproperty</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This decorator allows you to define functions on a class that are accessible directly from the</span>
<span class="sd">    class itself (rather than an instance of the class). It allows you to access ``classproperty``</span>
<span class="sd">    attributes directly, such as ``obj.property``, rather than as a function on a class instance</span>
<span class="sd">    (like ``obj = Obj(); obj.property()``).</span>

<span class="sd">    Borrowed from a StackOverflow `post &lt;https://stackoverflow.com/a/3203659&gt;`_.</span>

<span class="sd">    Usage::</span>

<span class="sd">        from pewtils import classproperty</span>

<span class="sd">        class MyClass(object):</span>
<span class="sd">            x = 4</span>

<span class="sd">            @classproperty</span>
<span class="sd">            def number(cls):</span>
<span class="sd">                return cls.x</span>

<span class="sd">        &gt;&gt;&gt; MyClass().number</span>
<span class="sd">        4</span>
<span class="sd">        &gt;&gt;&gt; MyClass.number</span>
<span class="sd">        4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fget</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fget</span> <span class="o">=</span> <span class="n">fget</span>

    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner_self</span><span class="p">,</span> <span class="n">owner_cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fget</span><span class="p">(</span><span class="n">owner_cls</span><span class="p">)</span></div>


<div class="viewcode-block" id="is_not_null"><a class="viewcode-back" href="../../pewtils_core.html#pewtils.__init__.is_not_null">[docs]</a><span class="k">def</span> <span class="nf">is_not_null</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">empty_lists_are_null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">custom_nulls</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks whether the value is null, using a variety of potential string values, etc. The following values are always</span>
<span class="sd">    considered null: ``numpy.nan, None, &quot;None&quot;, &quot;nan&quot;, &quot;&quot;, &quot; &quot;, &quot;NaN&quot;, &quot;none&quot;, &quot;n/a&quot;, &quot;NONE&quot;, &quot;N/A&quot;``</span>

<span class="sd">    :param val: The value to check</span>
<span class="sd">    :param empty_lists_are_null: Whether or not an empty list or :py:class:`pandas.DataFrame` should be considered \</span>
<span class="sd">    null (default=False)</span>
<span class="sd">    :type empty_lists_are_null: bool</span>
<span class="sd">    :param custom_nulls: an optional list of additional values to consider as null</span>
<span class="sd">    :type custom_nulls: list</span>
<span class="sd">    :return: True if the value is not null</span>
<span class="sd">    :rtype: bool</span>

<span class="sd">    Usage::</span>

<span class="sd">        from pewtils import is_not_null</span>

<span class="sd">        &gt;&gt;&gt; text = &quot;Hello&quot;</span>
<span class="sd">        &gt;&gt;&gt; is_not_null(text)</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">null_values</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="s2">&quot;nan&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;NaN&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;n/a&quot;</span><span class="p">,</span> <span class="s2">&quot;NONE&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">custom_nulls</span><span class="p">:</span>
        <span class="n">null_values</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">custom_nulls</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">empty_lists_are_null</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">empty_lists_are_null</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">good</span> <span class="o">=</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">null_values</span>
                <span class="k">if</span> <span class="n">good</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">good</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                            <span class="n">good</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="n">good</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="n">good</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="is_null"><a class="viewcode-back" href="../../pewtils_core.html#pewtils.__init__.is_null">[docs]</a><span class="k">def</span> <span class="nf">is_null</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">empty_lists_are_null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">custom_nulls</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the opposite of the outcome of :py:func:`pewtils.is_not_null`. The following values are always \</span>
<span class="sd">    considered null: ``numpy.nan, None, &quot;None&quot;, &quot;nan&quot;, &quot;&quot;, &quot; &quot;, &quot;NaN&quot;, &quot;none&quot;, &quot;n/a&quot;, &quot;NONE&quot;, &quot;N/A&quot;``</span>

<span class="sd">    :param val: The value to check</span>
<span class="sd">    :param empty_lists_are_null: Whether or not an empty list or :py:class:`pandas.DataFrame` should be considered \</span>
<span class="sd">    null (default=False)</span>
<span class="sd">    :type empty_lists_are_null: bool</span>
<span class="sd">    :param custom_nulls: an optional list of additional values to consider as null</span>
<span class="sd">    :type custom_nulls: list</span>
<span class="sd">    :return: True if the value is null</span>
<span class="sd">    :rtype: bool</span>

<span class="sd">    Usage::</span>

<span class="sd">        from pewtils import is_null</span>

<span class="sd">        &gt;&gt;&gt; empty_list = []</span>
<span class="sd">        &gt;&gt;&gt; is_null(empty_list, empty_lists_are_null=True)</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="ow">not</span> <span class="n">is_not_null</span><span class="p">(</span>
        <span class="n">val</span><span class="p">,</span> <span class="n">empty_lists_are_null</span><span class="o">=</span><span class="n">empty_lists_are_null</span><span class="p">,</span> <span class="n">custom_nulls</span><span class="o">=</span><span class="n">custom_nulls</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="decode_text"><a class="viewcode-back" href="../../pewtils_core.html#pewtils.__init__.decode_text">[docs]</a><span class="k">def</span> <span class="nf">decode_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">throw_loud_fail</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attempts to decode and re-encode text as ASCII. In the case of failure, it will attempt to detect the string&#39;s \</span>
<span class="sd">    encoding, decode it, and convert it to ASCII. If both these attempts fail, it will attempt to use the \</span>
<span class="sd">    :py:mod:`unidecode` package to transliterate into ASCII. And finally, if that doesn&#39;t work, it will forcibly \</span>
<span class="sd">    encode the text as ASCII and ignore non-ASCII characters.</span>

<span class="sd">    .. warning:: This function is potentially destructive to source input and should be used with some care. \</span>
<span class="sd">        Input text that cannot be decoded may be stripped out, or replaced with a similar ASCII character or other \</span>
<span class="sd">        placeholder, potentially resulting in an empty string.</span>

<span class="sd">    :param text: The text to process</span>
<span class="sd">    :type text: str</span>
<span class="sd">    :param throw_loud_fail: If True, exceptions will be raised, otherwise the function will fail silently and \</span>
<span class="sd">    return an empty string (default False)</span>
<span class="sd">    :type throw_loud_fail: bool</span>
<span class="sd">    :return: Decoded text, or empty string</span>
<span class="sd">    :rtype: str</span>

<span class="sd">    .. note:: In Python 3, the decode/encode attempts will fail by default, and the :py:mod:`unidecode` package will \</span>
<span class="sd">        be used to transliterate. In general, you shouldn&#39;t need to use this function in Python 3, but it shouldn&#39;t \</span>
<span class="sd">        hurt anything if you do.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">output_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_not_null</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="n">output_text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">UnicodeEncodeError</span><span class="p">,</span> <span class="ne">UnicodeDecodeError</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">output_text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">chardet</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">text</span><span class="p">)[</span><span class="s2">&quot;encoding&quot;</span><span class="p">])</span>
                    <span class="n">output_text</span> <span class="o">=</span> <span class="n">output_text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span>
                    <span class="ne">AttributeError</span><span class="p">,</span>
                    <span class="ne">TypeError</span><span class="p">,</span>
                    <span class="ne">UnicodeEncodeError</span><span class="p">,</span>
                    <span class="ne">UnicodeDecodeError</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">output_text</span> <span class="o">=</span> <span class="n">unidecode</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                    <span class="k">except</span> <span class="p">(</span>
                        <span class="ne">AttributeError</span><span class="p">,</span>
                        <span class="ne">TypeError</span><span class="p">,</span>
                        <span class="ne">UnicodeEncodeError</span><span class="p">,</span>
                        <span class="ne">UnicodeDecodeError</span><span class="p">,</span>
                    <span class="p">):</span>
                        <span class="k">if</span> <span class="n">throw_loud_fail</span><span class="p">:</span>
                            <span class="n">output_text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">output_text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                                    <span class="s2">&quot;ascii&quot;</span>
                                <span class="p">)</span>
                            <span class="k">except</span> <span class="p">(</span>
                                <span class="ne">AttributeError</span><span class="p">,</span>
                                <span class="ne">TypeError</span><span class="p">,</span>
                                <span class="ne">UnicodeEncodeError</span><span class="p">,</span>
                                <span class="ne">UnicodeDecodeError</span><span class="p">,</span>
                            <span class="p">):</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not decode&quot;</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="n">output_text</span> <span class="o">=</span> <span class="n">output_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\u0000</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output_text</span></div>


<div class="viewcode-block" id="get_hash"><a class="viewcode-back" href="../../pewtils_core.html#pewtils.__init__.get_hash">[docs]</a><span class="k">def</span> <span class="nf">get_hash</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">hash_function</span><span class="o">=</span><span class="s2">&quot;ssdeep&quot;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates hashed text using one of several available hashing functions.</span>

<span class="sd">    :param text: The string to hash</span>
<span class="sd">    :type text: str</span>
<span class="sd">    :param hash_function: The specific algorithm to use; options are ``&#39;nilsimsa&#39;``, ``&#39;md5&#39;``, and ``&#39;ssdeep&#39;`` \</span>
<span class="sd">    (default)</span>
<span class="sd">    :type hash_function: str</span>
<span class="sd">    :return: A hashed representation of the provided string</span>
<span class="sd">    :rtype: str</span>

<span class="sd">    .. note:: The string will be passed through :py:func:`pewtils.decode_text` and the returned value will be used \</span>
<span class="sd">    instead of the original value if it runs successfully, in order to ensure consistent hashing in both Python 2 and \</span>
<span class="sd">    3. By default the function uses the :py:mod:`ssdeep` algorithm, which generates context-sensitive hashes that are \</span>
<span class="sd">    useful for computing document similarities at scale.</span>

<span class="sd">    Usage::</span>

<span class="sd">        from pewtils import get_hash</span>

<span class="sd">        &gt;&gt;&gt; text = &#39;test_string&#39;</span>
<span class="sd">        &gt;&gt;&gt; get_hash(text)</span>
<span class="sd">        &#39;3:HI2:Hl&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">decoded_text</span> <span class="o">=</span> <span class="n">decode_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">decoded_text</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">decoded_text</span> <span class="o">=</span> <span class="n">text</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">decoded_text</span>
    <span class="k">if</span> <span class="n">hash_function</span> <span class="o">==</span> <span class="s2">&quot;nilsimsa&quot;</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">nilsimsa</span> <span class="k">import</span> <span class="n">Nilsimsa</span>

        <span class="n">hashed</span> <span class="o">=</span> <span class="n">Nilsimsa</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">hash_function</span> <span class="o">==</span> <span class="s2">&quot;md5&quot;</span><span class="p">:</span>
        <span class="n">hashed</span> <span class="o">=</span> <span class="n">md5</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">ssdeep</span>

        <span class="n">hashed</span> <span class="o">=</span> <span class="n">ssdeep</span><span class="o">.</span><span class="n">hash</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">hashed</span></div>


<div class="viewcode-block" id="zipcode_num_to_string"><a class="viewcode-back" href="../../pewtils_core.html#pewtils.__init__.zipcode_num_to_string">[docs]</a><span class="k">def</span> <span class="nf">zipcode_num_to_string</span><span class="p">(</span><span class="n">zipcode</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attempts to standardize a string/integer/float that contains a U.S. zipcode. Front-pads with zeroes and uses the \</span>
<span class="sd">    :py:mod:`zipcodes` library to ensure that the zipcode is real. If the zipcode doesn&#39;t validate successfully, \</span>
<span class="sd">    ``None`` will be returned.</span>

<span class="sd">    :param zip: Object that contains a sequence of digits (string, integer, float)</span>
<span class="sd">    :type zip: str or float or int</span>
<span class="sd">    :return: A 5-digit string, or None</span>
<span class="sd">    :rtype: str or NoneType</span>

<span class="sd">    Usage::</span>

<span class="sd">        from pewtils import zipcode_num_to_string</span>

<span class="sd">        &gt;&gt;&gt; zipcode_number = 6463</span>
<span class="sd">        &gt;&gt;&gt; zipcode_num_to_string(zipcode_number)</span>
<span class="sd">        &#39;06463&#39;</span>
<span class="sd">        &gt;&gt;&gt; not_zipcode_number = 345678</span>
<span class="sd">        &gt;&gt;&gt; zipcode_num_to_string(not_zipcode_number)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">is_not_null</span><span class="p">(</span><span class="n">zipcode</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">zipcode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">zipcode</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()[:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">zipcode</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">zipcode</span><span class="p">:</span>
            <span class="n">zipcode</span> <span class="o">=</span> <span class="n">zipcode</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">zipcodes</span><span class="o">.</span><span class="n">is_real</span><span class="p">(</span><span class="n">zipcode</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">zipcode</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="n">zipcode</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">zipcode</span></div>


<div class="viewcode-block" id="concat_text"><a class="viewcode-back" href="../../pewtils_core.html#pewtils.__init__.concat_text">[docs]</a><span class="k">def</span> <span class="nf">concat_text</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A helper function for concatenating text values. Text values are passed through :py:func:`pewtils.decode_text` \</span>
<span class="sd">    before concatenation.</span>

<span class="sd">    :param args: A list of text values that will be returned as a single space-separated string</span>
<span class="sd">    :type args: list</span>
<span class="sd">    :return: A single string of the values concatenated by spaces</span>
<span class="sd">    :rtype: str</span>

<span class="sd">    Usage::</span>

<span class="sd">        from pewtils import concat_text</span>

<span class="sd">        &gt;&gt;&gt; text_list = [&#39;Hello&#39;, &#39;World&#39;, &#39;!&#39;]</span>
<span class="sd">        &gt;&gt;&gt; concat_text(text_list)</span>
<span class="sd">        &#39;Hello World !&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">strs</span> <span class="o">=</span> <span class="p">[</span><span class="n">decode_text</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span> <span class="k">if</span> <span class="n">is_not_null</span><span class="p">(</span><span class="n">arg</span><span class="p">)]</span>
    <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strs</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_not_null</span><span class="p">(</span><span class="n">strs</span><span class="p">,</span> <span class="n">empty_lists_are_null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span></div>


<div class="viewcode-block" id="vector_concat_text"><a class="viewcode-back" href="../../pewtils_core.html#pewtils.__init__.vector_concat_text">[docs]</a><span class="k">def</span> <span class="nf">vector_concat_text</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a list of equal-length lists and returns a single list with the rows concatenated by spaces. Useful for \</span>
<span class="sd">    merging multiple columns of text in Pandas.</span>

<span class="sd">    :param args: A list of lists or :py:class:`pandas.Series` s that contain text values</span>
<span class="sd">    :return: A single list or :py:class:`pandas.Series` with all of the text values for each row concatenated</span>

<span class="sd">    Usage with lists::</span>

<span class="sd">        from pewtils import vector_concat_text</span>

<span class="sd">        &gt;&gt;&gt; text_lists = [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;], [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</span>
<span class="sd">        &gt;&gt;&gt; vector_concat_text(text_lists)</span>
<span class="sd">        [&#39;one a&#39;, &#39;two b&#39;, &#39;three c&#39;]</span>

<span class="sd">    Usage with Pandas::</span>

<span class="sd">        import pandas as pd</span>
<span class="sd">        from pewtils import vector_concat_text</span>

<span class="sd">        df = pd.DataFrame([</span>
<span class="sd">            {&quot;text1&quot;: &quot;one&quot;, &quot;text2&quot;: &quot;a&quot;},</span>
<span class="sd">            {&quot;text1&quot;: &quot;two&quot;, &quot;text2&quot;: &quot;b&quot;},</span>
<span class="sd">            {&quot;text1&quot;: &quot;three&quot;, &quot;text2&quot;: &quot;c&quot;}</span>
<span class="sd">        ])</span>

<span class="sd">        &gt;&gt;&gt; df[&#39;text&#39;] = vector_concat_text(df[&#39;text1&#39;], df[&#39;text2&#39;])</span>
<span class="sd">        &gt;&gt;&gt; df[&#39;text&#39;]</span>
<span class="sd">        0      one a</span>
<span class="sd">        1      two b</span>
<span class="sd">        2    three c</span>
<span class="sd">        Name: text, dtype: object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">concat_text</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></div>


<div class="viewcode-block" id="scale_range"><a class="viewcode-back" href="../../pewtils_core.html#pewtils.__init__.scale_range">[docs]</a><span class="k">def</span> <span class="nf">scale_range</span><span class="p">(</span><span class="n">old_val</span><span class="p">,</span> <span class="n">old_min</span><span class="p">,</span> <span class="n">old_max</span><span class="p">,</span> <span class="n">new_min</span><span class="p">,</span> <span class="n">new_max</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scales a value from one range to another.  Useful for comparing values from different scales, for example.</span>

<span class="sd">    :param old_val: The value to convert</span>
<span class="sd">    :type old_val: int or float</span>
<span class="sd">    :param old_min: The minimum of the old range</span>
<span class="sd">    :type old_min: int or float</span>
<span class="sd">    :param old_max: The maximum of the old range</span>
<span class="sd">    :type old_max: int or float</span>
<span class="sd">    :param new_min: The minimum of the new range</span>
<span class="sd">    :type new_min: int or float</span>
<span class="sd">    :param new_max: The maximum of the new range</span>
<span class="sd">    :type new_max: int or float</span>
<span class="sd">    :return: Value equivalent from the new scale</span>
<span class="sd">    :rtype: float</span>

<span class="sd">    Usage::</span>

<span class="sd">        from pewtils import scale_range</span>

<span class="sd">        &gt;&gt;&gt; old_value = 5</span>
<span class="sd">        &gt;&gt;&gt; scale_range(old_value, 0, 10, 0, 20)</span>
<span class="sd">        10.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">old_val</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">old_min</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">new_max</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_min</span><span class="p">)))</span>
        <span class="o">/</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">old_max</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">old_min</span><span class="p">))</span>
    <span class="p">)</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_min</span><span class="p">)</span></div>


<div class="viewcode-block" id="new_random_number"><a class="viewcode-back" href="../../pewtils_core.html#pewtils.__init__.new_random_number">[docs]</a><span class="k">def</span> <span class="nf">new_random_number</span><span class="p">(</span><span class="n">attempt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a random number between the boundary that exponentially increases with the number of ``attempt``.</span>
<span class="sd">    The upper bound is capped using the ``maximum`` parameter (default 10) but is otherwise determined by the</span>
<span class="sd">    function ``minimum * 2 ** attempt``.</span>

<span class="sd">    | In effect, this means that when ``attempt`` is 1, the number returned will be in the range of the minimum \</span>
<span class="sd">    and twice the minimum&#39;s value.  As you increase ``attempt``, the possible range of returned values expands \</span>
<span class="sd">    exponentially until it hits the ``maximum`` ceiling.</span>

<span class="sd">    :param attempt: Increasing attempt will expand the upper-bound of the range from which the random number is drawn</span>
<span class="sd">    :type attempt: int</span>
<span class="sd">    :param minimum: The minimum allowed value that can be returned; must be greater than zero.</span>
<span class="sd">    :type minimum: int or float</span>
<span class="sd">    :param maximum: The maximum allowed value that can be returned; must be greater than ``minimum``.</span>
<span class="sd">    :type maximum: int or float</span>
<span class="sd">    :return: A random number drawn uniformly from across the range determined by the provided arguments.</span>
<span class="sd">    :rtype: float</span>

<span class="sd">    .. note:: One useful application of this function is rate limiting: a script can pause in between requests at a \</span>
<span class="sd">        reasonably fast pace, but then moderate itself and pause for longer periods if it begins encountering errors, \</span>
<span class="sd">        simply by increasing the ``attempt`` variable (hence its name).</span>

<span class="sd">    Usage::</span>

<span class="sd">        from pewtils import new_random_number</span>

<span class="sd">        &gt;&gt;&gt; new_random_number(attempt=1)</span>
<span class="sd">        1.9835581813820642</span>
<span class="sd">        &gt;&gt;&gt; new_random_number(attempt=2)</span>
<span class="sd">        3.1022350739064</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">uniform</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">maximum</span><span class="p">,</span> <span class="n">minimum</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">))</span></div>


<div class="viewcode-block" id="chunk_list"><a class="viewcode-back" href="../../pewtils_core.html#pewtils.__init__.chunk_list">[docs]</a><span class="k">def</span> <span class="nf">chunk_list</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a sequence and groups values into smaller lists based on the specified size.</span>

<span class="sd">    :param seq: List or a list-like iterable</span>
<span class="sd">    :type seq: list or iterable</span>
<span class="sd">    :param size: Desired size of each sublist</span>
<span class="sd">    :type size: int</span>
<span class="sd">    :return: A list of lists</span>
<span class="sd">    :rtype: list</span>

<span class="sd">    Usage::</span>

<span class="sd">        from pewtils import chunk_list</span>

<span class="sd">        &gt;&gt;&gt; number_sequence = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span>
<span class="sd">        &gt;&gt;&gt; chunk_list(number_sequence, 3)</span>
<span class="sd">        [[1, 2, 3], [4, 5, 6], [7, 8, 9], [10]]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="n">pos</span> <span class="p">:</span> <span class="p">(</span><span class="n">pos</span> <span class="o">+</span> <span class="n">size</span><span class="p">)]</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">),</span> <span class="n">size</span><span class="p">))</span></div>


<div class="viewcode-block" id="flatten_list"><a class="viewcode-back" href="../../pewtils_core.html#pewtils.__init__.flatten_list">[docs]</a><span class="k">def</span> <span class="nf">flatten_list</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a list of lists and flattens it into a single list. Nice shortcut to avoid having to deal with list \</span>
<span class="sd">    comprehension.</span>

<span class="sd">    :param l: A list of lists</span>
<span class="sd">    :type l: list</span>
<span class="sd">    :return: A flattened list of all of the elements contained in the original list of lists</span>
<span class="sd">    :rtype: list</span>

<span class="sd">    Usage::</span>

<span class="sd">        from pewtils import flatten_list</span>

<span class="sd">        &gt;&gt;&gt; nested_lists = [[1, 2, 3], [4, 5, 6]]</span>
<span class="sd">        &gt;&gt;&gt; flatten_list(nested_lists)</span>
<span class="sd">        [1, 2, 3, 4, 5, 6]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">l</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span></div>


<div class="viewcode-block" id="scan_dictionary"><a class="viewcode-back" href="../../pewtils_core.html#pewtils.__init__.scan_dictionary">[docs]</a><span class="k">def</span> <span class="nf">scan_dictionary</span><span class="p">(</span><span class="n">search_dict</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a dictionary with nested lists and dictionaries, and searches recursively for a specific key. Since keys can</span>
<span class="sd">    occur more than once, the function returns a list of all of the found values along with a list of equal length</span>
<span class="sd">    that specifies the nested key path to each value.</span>

<span class="sd">    :param search_dict: The dictionary to search</span>
<span class="sd">    :type search_dict: dict</span>
<span class="sd">    :param field: The field to find</span>
<span class="sd">    :type field: str</span>
<span class="sd">    :return: A tuple of the found values and file path-style strings representing their locations</span>
<span class="sd">    :rtype: tuple</span>

<span class="sd">    Usage::</span>

<span class="sd">        from pewtils import scan_dictionary</span>

<span class="sd">        &gt;&gt;&gt; test_dict = {&quot;one&quot;: {&quot;two&quot;: {&quot;three&quot;: &quot;four&quot;}}}</span>
<span class="sd">        &gt;&gt;&gt; scan_dictionary(test_dict, &quot;three&quot;)</span>
<span class="sd">        ([&#39;four&#39;], [&#39;one/two/three/&#39;])</span>
<span class="sd">        &gt;&gt;&gt; scan_dictionary(test_dict, &quot;five&quot;)</span>
<span class="sd">        ([], [])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fields_found</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">key_path</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">search_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">field</span><span class="p">:</span>
            <span class="n">fields_found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">new_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
            <span class="n">key_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_str</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">results</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">scan_dictionary</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">fields_found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">road</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="n">new_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">road</span>
                <span class="n">key_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_str</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">more_results</span><span class="p">,</span> <span class="n">more_path</span> <span class="o">=</span> <span class="n">scan_dictionary</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">another_result</span> <span class="ow">in</span> <span class="n">more_results</span><span class="p">:</span>
                        <span class="n">fields_found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">another_result</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">another_road</span> <span class="ow">in</span> <span class="n">more_path</span><span class="p">:</span>
                        <span class="n">new_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">another_road</span>
                        <span class="n">key_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_str</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fields_found</span><span class="p">,</span> <span class="n">key_path</span></div>


<div class="viewcode-block" id="recursive_update"><a class="viewcode-back" href="../../pewtils_core.html#pewtils.__init__.recursive_update">[docs]</a><span class="k">def</span> <span class="nf">recursive_update</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes an object and a dictionary representation of attributes and values, and recursively traverses through the</span>
<span class="sd">    new values and updates the object.</span>

<span class="sd">    | Regardless of whether or not the keys in the dictionary correspond to attribute names or dictionary keys; \</span>
<span class="sd">    you can use this to iterate through a nested hierarchy of objects and dictionaries and update whatever you like.</span>

<span class="sd">    :param existing: An object or dictionary</span>
<span class="sd">    :type existing: dict or object</span>
<span class="sd">    :param new: A dictionary where keys correspond to the names of keys in the existing dictionary or attributes on \</span>
<span class="sd">    the existing object</span>
<span class="sd">    :type new: dict or object</span>
<span class="sd">    :return: A copy of the original object or dictionary, with the values updated based on the provided map</span>
<span class="sd">    :rtype: dict or object</span>

<span class="sd">    Usage::</span>

<span class="sd">        from pewtils import recursive_update</span>

<span class="sd">        class TestObject(object):</span>
<span class="sd">            def __init__(self, value):</span>
<span class="sd">                self.value = value</span>
<span class="sd">                self.dict = {&quot;obj_key&quot;: &quot;original&quot;}</span>
<span class="sd">            def __repr__(self):</span>
<span class="sd">                return(&quot;TestObject(value=&#39;{}&#39;, dict={})&quot;.format(self.value, self.dict))</span>

<span class="sd">        original = {</span>
<span class="sd">            &quot;object&quot;: TestObject(&quot;original&quot;),</span>
<span class="sd">            &quot;key1&quot;: {&quot;key2&quot;: &quot;original&quot;}</span>
<span class="sd">        }</span>
<span class="sd">        update = {</span>
<span class="sd">            &quot;object&quot;: {&quot;value&quot;: &quot;updated&quot;, &quot;dict&quot;: {&quot;obj_key&quot;: &quot;updated&quot;}},</span>
<span class="sd">            &quot;key1&quot;: {&quot;key3&quot;: &quot;new&quot;}</span>
<span class="sd">        }</span>

<span class="sd">        &gt;&gt;&gt; recursive_update(original, update)</span>
<span class="sd">        {&#39;object&#39;: TestObject(value=&#39;updated&#39;, dict={&#39;obj_key&#39;: &#39;updated&#39;}),</span>
<span class="sd">         &#39;key1&#39;: {&#39;key2&#39;: &#39;original&#39;, &#39;key3&#39;: &#39;new&#39;}}</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">obj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">obj</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">_getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

    <span class="n">existing</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">existing</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">new</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="n">_hasattr</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
                <span class="n">_setattr</span><span class="p">(</span>
                    <span class="n">existing</span><span class="p">,</span>
                    <span class="n">k</span><span class="p">,</span>
                    <span class="n">recursive_update</span><span class="p">(</span><span class="n">_getattr</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">_getattr</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">k</span><span class="p">)),</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_setattr</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">_getattr</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">existing</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">new</span></div>


<div class="viewcode-block" id="cached_series_mapper"><a class="viewcode-back" href="../../pewtils_core.html#pewtils.__init__.cached_series_mapper">[docs]</a><span class="k">def</span> <span class="nf">cached_series_mapper</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies a function to all of the unique values in a :py:class:`pandas.Series` to avoid repeating the operation \</span>
<span class="sd">    on duplicate values.</span>

<span class="sd">    | Great if you&#39;re doing database lookups or something computationally intensive on a column that may contain \</span>
<span class="sd">    repeating values, etc.</span>

<span class="sd">    :param series: A :py:class:`pandas.Series`</span>
<span class="sd">    :type series: :py:class:`pandas.Series`</span>
<span class="sd">    :param function: A function to apply to values in the :py:class:`pandas.Series`</span>
<span class="sd">    :return: The resulting :py:class:`pandas.Series`</span>
<span class="sd">    :rtype: :py:class:`pandas.Series`</span>

<span class="sd">    Usage::</span>

<span class="sd">        import pandas as pd</span>
<span class="sd">        from pewtils import cached_series_mapper</span>

<span class="sd">        values = [&quot;value&quot;]*10</span>
<span class="sd">        def my_function(x):</span>
<span class="sd">            print(x)</span>
<span class="sd">            return x</span>

<span class="sd">        df = pd.DataFrame(values, columns=[&#39;column&#39;])</span>
<span class="sd">        &gt;&gt;&gt; mapped = df[&#39;column&#39;].map(my_function)</span>
<span class="sd">        value</span>
<span class="sd">        value</span>
<span class="sd">        value</span>
<span class="sd">        value</span>
<span class="sd">        value</span>
<span class="sd">        value</span>
<span class="sd">        value</span>
<span class="sd">        value</span>
<span class="sd">        value</span>
<span class="sd">        value</span>
<span class="sd">        &gt;&gt;&gt; mapped = cached_series_mapper(df[&#39;column&#39;], my_function)</span>
<span class="sd">        value</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">val_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">series</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">val_map</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">series</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">val_map</span><span class="p">)</span></div>


<div class="viewcode-block" id="extract_json_from_folder"><a class="viewcode-back" href="../../pewtils_core.html#pewtils.__init__.extract_json_from_folder">[docs]</a><span class="k">def</span> <span class="nf">extract_json_from_folder</span><span class="p">(</span>
    <span class="n">folder_path</span><span class="p">,</span> <span class="n">include_subdirs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">concat_subdir_names</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a folder path and traverses it, looking for JSON files. When it finds one, it adds it to a dictionary,</span>
<span class="sd">    with the key being the name of the file and the value being the JSON itself. This is useful if you store \</span>
<span class="sd">    configurations or various metadata in a nested folder structure, which we do for things like content analysis \</span>
<span class="sd">    codebooks.</span>

<span class="sd">    | Has options for recursively traversing a folder, and for optionally concatenating the subfolder names \</span>
<span class="sd">    into the dictionary keys as prefixes.</span>

<span class="sd">    :param folder_path: The path of the folder to scan</span>
<span class="sd">    :type folder_path: str</span>
<span class="sd">    :param include_subdirs: Whether or not to recursively scan subfolders</span>
<span class="sd">    :type include_subdirs: bool</span>
<span class="sd">    :param concat_subdir_names: Whether or not to prefix the dictionary keys with the names of subfolders</span>
<span class="sd">    :type concat_subdir_names: bool</span>
<span class="sd">    :return: A dictionary containing all of the abstracted JSON files as values</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    Usage::</span>

<span class="sd">        # For example, let&#39;s say we have the following folder structure</span>
<span class="sd">        # with various JSON codebooks scattered about:</span>
<span class="sd">        #</span>
<span class="sd">        # /codebooks</span>
<span class="sd">        #     /logos</span>
<span class="sd">        #         /antipathy.json</span>
<span class="sd">        #     /atp_open_ends</span>
<span class="sd">        #         /w29</span>
<span class="sd">        #             /sources_of_meaning.json</span>
<span class="sd">        #</span>
<span class="sd">        # Here&#39;s what we&#39;d get depending on the different parameters we use:</span>

<span class="sd">        from pewtils import extract_json_from_folder</span>
<span class="sd">        &gt;&gt;&gt; extract_json_from_folder(&quot;codebooks&quot;, include_subdirs=False, concat_subdir_names=False)</span>
<span class="sd">        {}</span>
<span class="sd">        &gt;&gt;&gt; extract_json_from_folder(&quot;codebooks&quot;, include_subdirs=True, concat_subdir_names=False)</span>
<span class="sd">        {</span>
<span class="sd">            &quot;logos&quot;: {&quot;antipathy&quot;: &quot;json would be here&quot;},</span>
<span class="sd">            &quot;atp_open_ends&quot;: {&quot;w29&quot;: {&quot;sources_of_meaning&quot;: &quot;json would be here&quot;}}</span>
<span class="sd">        }</span>
<span class="sd">        &gt;&gt;&gt; extract_json_from_folder(&quot;codebooks&quot;, include_subdirs=True, concat_subdir_names=True)</span>
<span class="sd">        {</span>
<span class="sd">            &quot;logos_antipathy&quot;: &quot;json would be here&quot;,</span>
<span class="sd">            &quot;atp_open_ends_w29_sources_of_meaning&quot;: &quot;json would be here&quot;</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">subdirs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">subdir</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">walk</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">folder_path</span> <span class="o">==</span> <span class="n">path</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">):</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                        <span class="k">with</span> <span class="n">closing</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">))</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JSON file is invalid: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">subdir</span><span class="p">:</span>
                <span class="n">subdirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subdir</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">include_subdirs</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">subdirs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">subdir</span> <span class="ow">in</span> <span class="n">subdirs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">subdir</span> <span class="o">!=</span> <span class="s2">&quot;__pycache__&quot;</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">extract_json_from_folder</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">subdir</span><span class="p">),</span>
                    <span class="n">include_subdirs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">concat_subdir_names</span><span class="o">=</span><span class="n">concat_subdir_names</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">concat_subdir_names</span><span class="p">:</span>
                    <span class="n">attributes</span><span class="p">[</span><span class="n">subdir</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">subattr_name</span><span class="p">,</span> <span class="n">subattr</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">subdir</span><span class="p">,</span> <span class="n">subattr_name</span><span class="p">])]</span> <span class="o">=</span> <span class="n">subattr</span>

    <span class="k">return</span> <span class="n">attributes</span></div>


<div class="viewcode-block" id="extract_attributes_from_folder_modules"><a class="viewcode-back" href="../../pewtils_core.html#pewtils.__init__.extract_attributes_from_folder_modules">[docs]</a><span class="k">def</span> <span class="nf">extract_attributes_from_folder_modules</span><span class="p">(</span>
    <span class="n">folder_path</span><span class="p">,</span>
    <span class="n">attribute_name</span><span class="p">,</span>
    <span class="n">include_subdirs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">concat_subdir_names</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">current_subdirs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a folder path and traverses it, looking for Python files that contain an attribute (i.e., class, function,</span>
<span class="sd">    etc.) with a given name. It extracts those attributes and returns a dictionary where the keys are the names of the</span>
<span class="sd">    files that contained the attributes, and the values are the attributes themselves.</span>

<span class="sd">    This operates exactly the same as :py:func:`pewtils.extract_json_from_folder` except instead of reading JSON files</span>
<span class="sd">    and adding them as values in the dictionary that gets returned, this function will instead look for Python files</span>
<span class="sd">    that contain a function, class, method, or attribute with the name you provide in ``attribute_name`` and will load</span>
<span class="sd">    that attribute in as the values.</span>

<span class="sd">    :param folder_path: The path of a folder/module to scan</span>
<span class="sd">    :type folder_path: str</span>
<span class="sd">    :param attribute_name: The name of the attribute (class, function, variable, etc.) to extract from files</span>
<span class="sd">    :type attribute_name: str</span>
<span class="sd">    :param include_subdirs: Whether or not to recursively scan subfolders</span>
<span class="sd">    :type include_subdirs: bool</span>
<span class="sd">    :param concat_subdir_names: Whether or not to prefix the dictionary keys with the names of subfolders</span>
<span class="sd">    :type concat_subdir_names: bool</span>
<span class="sd">    :param current_subdirs: Used to track location when recursively iterating a module (do not use)</span>
<span class="sd">    :return: A dictionary with all of the extracted attributes as values</span>
<span class="sd">    :rtype: dict</span>

<span class="sd">    .. note:: if you use Python 2.7 you will need to add ``from __future__ import absolute_import`` to the top of files \</span>
<span class="sd">        that you want to scan and import using this function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">folder_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()):</span>
        <span class="n">folder_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">folder_path</span><span class="p">)</span>
    <span class="n">test_path</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">test_path</span> <span class="o">!=</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;__init__.py&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">test_path</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="n">test_path</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">test_path</span><span class="p">)</span>
    <span class="n">module_location</span> <span class="o">=</span> <span class="n">test_path</span>

    <span class="n">current_folder</span> <span class="o">=</span> <span class="n">folder_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">current_subdirs</span><span class="p">:</span>
        <span class="n">current_subdirs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">subdirs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">subdir_list</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">walk</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">folder_path</span> <span class="o">==</span> <span class="n">path</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.py&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__init__&quot;</span><span class="p">):</span>
                        <span class="n">file_name</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">module_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
                            <span class="s2">&quot;/&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;.&quot;</span><span class="p">,</span>
                            <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
                                <span class="n">module_location</span><span class="p">,</span>
                                <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">file</span><span class="p">))[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="p">),</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">module_name</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
                            <span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span>
                            <span class="c1"># https://github.com/ansible/ansible/issues/13110</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">module</span> <span class="o">=</span> <span class="n">SourceFileLoader</span><span class="p">(</span>
                                    <span class="n">module_name</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                                <span class="p">)</span><span class="o">.</span><span class="n">load_module</span><span class="p">()</span>
                            <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
                                <span class="n">file</span><span class="p">,</span> <span class="n">pathname</span><span class="p">,</span> <span class="n">description</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span>
                                    <span class="n">file_name</span><span class="p">,</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
                                <span class="p">)</span>
                                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">module</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span>
                                        <span class="n">module_name</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">pathname</span><span class="p">,</span> <span class="n">description</span>
                                    <span class="p">)</span>
                                <span class="k">except</span> <span class="ne">RuntimeWarning</span><span class="p">:</span>
                                    <span class="k">try</span><span class="p">:</span>
                                        <span class="n">module</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span>
                                            <span class="n">module_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                            <span class="n">file</span><span class="p">,</span>
                                            <span class="n">pathname</span><span class="p">,</span>
                                            <span class="n">description</span><span class="p">,</span>
                                        <span class="p">)</span>
                                    <span class="k">except</span> <span class="ne">RuntimeWarning</span><span class="p">:</span>
                                        <span class="n">module</span> <span class="o">=</span> <span class="kc">None</span>
                                    <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                                        <span class="n">module</span> <span class="o">=</span> <span class="kc">None</span>
                                <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                                    <span class="n">module</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">):</span>
                            <span class="n">attributes</span><span class="p">[</span><span class="n">file_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">subdir_list</span><span class="p">:</span>
                <span class="n">subdirs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">subdir_list</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">include_subdirs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">subdir</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">subdirs</span><span class="p">):</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">extract_attributes_from_folder_modules</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">subdir</span><span class="p">),</span>
                <span class="n">attribute_name</span><span class="p">,</span>
                <span class="n">concat_subdir_names</span><span class="o">=</span><span class="n">concat_subdir_names</span><span class="p">,</span>
                <span class="n">include_subdirs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">current_subdirs</span><span class="o">=</span><span class="n">current_subdirs</span> <span class="o">+</span> <span class="p">[</span><span class="n">current_folder</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">concat_subdir_names</span><span class="p">:</span>
                <span class="n">attributes</span><span class="p">[</span><span class="n">subdir</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">subattr_name</span><span class="p">,</span> <span class="n">subattr</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">subdir</span><span class="p">,</span> <span class="n">subattr_name</span><span class="p">])]</span> <span class="o">=</span> <span class="n">subattr</span>

    <span class="k">if</span> <span class="n">is_null</span><span class="p">(</span><span class="n">current_subdirs</span><span class="p">,</span> <span class="n">empty_lists_are_null</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">attributes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">return</span> <span class="n">attributes</span></div>


<span class="k">class</span> <span class="nc">timeout_wrapper</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">error_message</span><span class="o">=</span><span class="s2">&quot;Timeout&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Context manager that will raise an error if it takes longer than the specified number of seconds to execute.</span>
<span class="sd">        Found via this very helpful Stack Overflow post:</span>
<span class="sd">        https://stackoverflow.com/questions/2281850/timeout-function-if-it-takes-too-long-to-finish</span>

<span class="sd">        :param seconds: Number of seconds allowed for the code to execute</span>
<span class="sd">        :param error_message: Optional custom error message to raise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">=</span> <span class="n">seconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_message</span> <span class="o">=</span> <span class="n">error_message</span>

    <span class="k">def</span> <span class="nf">handle_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGALRM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_timeout</span><span class="p">)</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Pew Research Center

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>